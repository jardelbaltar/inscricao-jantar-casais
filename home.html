<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Central de Evento — Casais 2 em 1</title>

<style>
:root{
  --bg:#0b1220;
  --bg2:#0a1a2f;
  --card: rgba(255,255,255,.06);
  --card2: rgba(255,255,255,.04);
  --line: rgba(255,255,255,.10);
  --text:#eaf0ff;
  --muted:#9db0d1;

  --accent:#2dd4bf;
  --accent2:#60a5fa;
  --accent3:#a78bfa;

  --shadow: 0 12px 30px rgba(0,0,0,.35);
  --shadow2: 0 16px 45px rgba(0,0,0,.45);
  --radius: 16px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--text);
  background:
    radial-gradient(1200px 800px at 15% 10%, rgba(45,212,191,.14), transparent 55%),
    radial-gradient(1100px 740px at 85% 15%, rgba(96,165,250,.14), transparent 55%),
    radial-gradient(900px 650px at 50% 95%, rgba(167,139,250,.10), transparent 55%),
    linear-gradient(180deg, var(--bg), var(--bg2));
  min-height:100vh;
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:22px 16px 34px;
}

/* ===== Topo ===== */

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:18px;
}

.brand{
  display:flex;
  align-items:center;
  gap:14px;
}

.brandMark img{
  width:52px;
  height:52px;
  object-fit:contain;
}

.brandText{
  display:flex;
  flex-direction:column;
  gap:6px;
}

.brand h1{
  margin:0;
  font-size:22px;
  font-weight:900;
}

.subtitle{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  color:var(--muted);
  font-size:13px;
}

.chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border:1px solid var(--line);
  border-radius:999px;
  background: rgba(255,255,255,.04);
}

.dot{
  width:8px;height:8px;border-radius:999px;
  background:var(--accent);
}

/* ===== Painel EVENT_ID ===== */

.panel{
  border:1px solid var(--line);
  background: linear-gradient(180deg, var(--card), var(--card2));
  border-radius: var(--radius);
  padding:14px;
  box-shadow: var(--shadow);
}

.controls{
  display:grid;
  grid-template-columns: 1fr auto auto auto;
  gap:10px;
  align-items:end;
}

@media (max-width: 900px){
  .controls{ grid-template-columns:1fr; }
}

label{
  font-size:12px;
  font-weight:700;
  color:var(--muted);
  display:block;
  margin-bottom:6px;
}

input,
select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--line);
  background: rgba(0,0,0,.22);
  color:var(--text);
}

.btn{
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color:var(--text);
  cursor:pointer;
  font-weight:800;
  transition:.2s ease;
}

.btn:hover{
  transform:translateY(-1px);
  box-shadow:var(--shadow);
}

.btnPrimary{
  background: linear-gradient(90deg, rgba(45,212,191,.22), rgba(96,165,250,.18));
  border-color: rgba(45,212,191,.35);
}

.btnIconLabel{
  display:inline-flex;
  align-items:center;
  gap:8px;
}

.btnIconLabel svg{
  width:18px;
  height:18px;
  stroke:currentColor;
  fill:none;
  stroke-width:1.8;
  stroke-linecap:round;
  stroke-linejoin:round;
}

.modalBackdrop{
  position:fixed;
  inset:0;
  background:rgba(2, 10, 20, .72);
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:1000;
}

.modalBackdrop.open{ display:flex; }

.modalCard{
  width:min(92vw, 480px);
  border:1px solid var(--line);
  background: linear-gradient(180deg, rgba(13,23,41,.96), rgba(9,18,32,.96));
  border-radius: var(--radius);
  box-shadow: var(--shadow2);
  padding:18px;
}

.modalHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
}

.modalTitle{
  margin:0;
  font-size:17px;
  font-weight:900;
}

.iconClose{
  width:36px;
  height:36px;
  border-radius:999px;
  border:1px solid var(--line);
  background: rgba(255,255,255,.03);
  color:var(--text);
  cursor:pointer;
  font-size:18px;
  line-height:1;
}

.qrFrame{
  width:100%;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:white;
  padding:12px;
}

.qrFrame img{
  display:block;
  width:100%;
  height:auto;
}

.modalHint{
  margin:12px 0 0;
  color:var(--muted);
  font-size:13px;
}

/* ===== Cards ===== */

.grid{
  margin-top:18px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:16px;
}

@media (max-width: 1000px){ .grid{grid-template-columns: repeat(2, 1fr);} }
@media (max-width: 680px){ .grid{grid-template-columns: 1fr;} }

.card{
  border:1px solid var(--line);
  background: linear-gradient(180deg, var(--card), var(--card2));
  border-radius: var(--radius);
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
  box-shadow:var(--shadow);
  cursor:pointer;
  transition:.2s ease;
}

.cardHead{
  display:flex;
  align-items:center;
  gap:10px;
}

.cardIcon{
  width:38px;
  height:38px;
  stroke:#7dd3fc;
  fill:none;
  stroke-width:1.9;
  stroke-linecap:round;
  stroke-linejoin:round;
  filter:drop-shadow(0 0 10px rgba(56,189,248,.35));
  flex-shrink:0;
}

.cardIcon.fill{
  fill:rgba(125,211,252,.15);
}

.card:hover{
  transform:translateY(-3px);
  box-shadow:var(--shadow2);
}

.cardTitle{
  margin:0;
  font-weight:900;
}

.cardDesc{
  color:var(--muted);
  font-size:13px;
}

.footer{
  margin-top:20px;
  color:var(--muted);
  font-size:12px;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
}
</style>
</head>

<body>
<div class="container">

<div class="topbar">
  <div class="brand">
    <div class="brandMark">
      <img src="/logo-modern-noglow.png" alt="Casais 2 em 1">
    </div>
    <div class="brandText">
      <h1>Central de Eventos</h1>
    </div>
  </div>
</div>

<div class="panel">
  <div class="controls">
    <div>
      <label>Evento</label>
      <select id="eventId">
        <option value="">Carregando eventos...</option>
      </select>
    </div>
    <button class="btn btnPrimary" onclick="saveEvent()">Salvar</button>
    <button class="btn" onclick="copyInscricao()">Copiar link da inscrição</button>
    <button class="btn btnIconLabel" onclick="openInscricaoQr()" aria-label="Apresentar QR Code da inscrição">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <rect x="3" y="3" width="7" height="7"></rect>
        <rect x="14" y="3" width="7" height="7"></rect>
        <rect x="3" y="14" width="7" height="7"></rect>
        <path d="M14 14h3"></path>
        <path d="M17 14v3"></path>
        <path d="M21 17h-2"></path>
        <path d="M14 19h2"></path>
        <path d="M18 21h3"></path>
      </svg>
      Apresentar QR Code da inscrição
    </button>
  </div>
</div>

<div id="qrModal" class="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="qrModalTitle" onclick="handleModalClick(event)">
  <div class="modalCard">
    <div class="modalHeader">
      <h2 id="qrModalTitle" class="modalTitle">QR Code da inscrição</h2>
      <button class="iconClose" onclick="closeInscricaoQr()" aria-label="Fechar modal">×</button>
    </div>
    <div class="qrFrame">
      <img id="inscricaoQrImage" alt="QR Code do link da inscrição">
    </div>
    <p class="modalHint">Peça para os convidados escanearem este QR Code para abrir a inscrição.</p>
  </div>
</div>

<div class="grid">
  <div class="card" onclick="go('index.html')">
    <div class="cardHead">
      <svg class="cardIcon" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="6" y="3" width="12" height="18" rx="2"></rect>
        <path d="M9 3.5h6"></path>
        <path d="M9 8h6"></path>
        <path d="M9 12h6"></path>
        <path d="M9 16h4"></path>
      </svg>
      <h3 class="cardTitle">Inscrição</h3>
    </div>
    <p class="cardDesc">Formulário público via QR Code.</p>
  </div>

  <div class="card" onclick="go('painel.html')">
    <div class="cardHead">
      <svg class="cardIcon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 20h16"></path>
        <rect x="6" y="11" width="2.5" height="7"></rect>
        <rect x="11" y="8" width="2.5" height="10"></rect>
        <rect x="16" y="5" width="2.5" height="13"></rect>
      </svg>
      <h3 class="cardTitle">Acompanhamento</h3>
    </div>
    <p class="cardDesc">Visualize inscrições em tempo real.</p>
  </div>

  <div class="card" onclick="go('admin.html')">
    <div class="cardHead">
      <svg class="cardIcon fill" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M10.8 2.4h2.4l.5 2.1c.5.1 1 .3 1.5.6l1.9-1.1 1.7 1.7-1.1 1.9c.3.5.5 1 .6 1.5l2.1.5v2.4l-2.1.5c-.1.5-.3 1-.6 1.5l1.1 1.9-1.7 1.7-1.9-1.1c-.5.3-1 .5-1.5.6l-.5 2.1h-2.4l-.5-2.1c-.5-.1-1-.3-1.5-.6l-1.9 1.1-1.7-1.7 1.1-1.9c-.3-.5-.5-1-.6-1.5l-2.1-.5V9.8l2.1-.5c.1-.5.3-1 .6-1.5L5.2 5.9 6.9 4.2l1.9 1.1c.5-.3 1-.5 1.5-.6z"></path>
        <circle cx="12" cy="11" r="2.8"></circle>
      </svg>
      <h3 class="cardTitle">Administração</h3>
    </div>
    <p class="cardDesc">Gerencie vagas e pratos.</p>
  </div>

  <div class="card" onclick="go('checkin.html')">
    <div class="cardHead">
      <svg class="cardIcon" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="9"></circle>
        <path d="M8.5 12.5l2.3 2.3 4.8-5.2"></path>
      </svg>
      <h3 class="cardTitle">Check-in</h3>
    </div>
    <p class="cardDesc">Controle de presença.</p>
  </div>

  <div class="card" onclick="go('stats.html')">
    <div class="cardHead">
      <svg class="cardIcon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 20V4"></path>
        <path d="M4 20h16"></path>
        <path d="M8 15l3-3 3 1 3-5"></path>
      </svg>
      <h3 class="cardTitle">Estatísticas</h3>
    </div>
    <p class="cardDesc">Dashboard completo do evento.</p>
  </div>

  <div class="card" onclick="go('sorteio.html')">
    <div class="cardHead">
      <svg class="cardIcon" viewBox="0 0 24 24" aria-hidden="true">
        <rect x="4" y="10" width="16" height="10" rx="2"></rect>
        <path d="M12 10v10"></path>
        <path d="M4 14h16"></path>
        <path d="M8.5 7.8A2.3 2.3 0 0 1 12 10"></path>
        <path d="M15.5 7.8A2.3 2.3 0 0 0 12 10"></path>
      </svg>
      <h3 class="cardTitle">Sorteio</h3>
    </div>
    <p class="cardDesc">Momento show de TV.</p>
  </div>
</div>

<div class="footer">
  <div>Salve o EVENT_ID uma vez e navegue pelos módulos.</div>
  <div>home.html?event=UUID</div>
</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.95.3/+esm";

const STORAGE_KEY="EVENT_ID";
const SUPABASE_URL = "https://nuqcefxwarrjehvhdoug.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51cWNlZnh3YXJyamVodmhkb3VnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NzE1NzUsImV4cCI6MjA4NjM0NzU3NX0.xLugRmdl6UKVsMZnDepBlFndh4vGVMnptuloFZC28Mc";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const eventSelect = document.getElementById("eventId");
const eventChip = document.getElementById("eventChip");
const statusText = document.getElementById("statusText");
const qrModal = document.getElementById("qrModal");
const inscricaoQrImage = document.getElementById("inscricaoQrImage");

function getInscricaoLink(){
  const id=localStorage.getItem(STORAGE_KEY);
  if(!id) return null;
  const base=location.href.replace(/[^\/]*$/,"");
  return base+"index.html?event="+id;
}

function setEventChip(id){
  if(!eventChip) return;
  eventChip.textContent = "EVENT_ID: " + (id || "—");
}

function formatDateTime(value) {
  if (!value) return "—";
  const d = new Date(value);
  if (Number.isNaN(d.getTime())) return "—";
  const pad = (n) => String(n).padStart(2, "0");
  const minutes = d.getMinutes();
  const timeLabel = minutes === 0
    ? `${pad(d.getHours())}h`
    : `${pad(d.getHours())}h${pad(minutes)}`;
  return `${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${d.getFullYear()} ${timeLabel}`;
}

function setStatus(text){
  if(!statusText) return;
  statusText.textContent = text;
}

function saveEvent(){
  const id = eventSelect.value;
  if(!id){ alert("Selecione um evento"); return; }
  localStorage.setItem(STORAGE_KEY,id);
  setEventChip(id);
  setStatus("Evento configurado");
}

async function copyInscricao(){
  const inscricaoLink=getInscricaoLink();
  if(!inscricaoLink){ alert("Defina o evento primeiro"); return; }
  await navigator.clipboard.writeText(inscricaoLink);
  alert("Link copiado!");
}

function openInscricaoQr(){
  const inscricaoLink=getInscricaoLink();
  if(!inscricaoLink){ alert("Defina o evento primeiro"); return; }
  const encodedLink=encodeURIComponent(inscricaoLink);
  inscricaoQrImage.src = `https://api.qrserver.com/v1/create-qr-code/?size=420x420&data=${encodedLink}`;
  qrModal.classList.add("open");
}

function closeInscricaoQr(){
  qrModal.classList.remove("open");
}

function handleModalClick(event){
  if(event.target === qrModal){
    closeInscricaoQr();
  }
}

function go(page){
  const id=localStorage.getItem(STORAGE_KEY);
  if(!id){ alert("Defina o evento primeiro"); return; }
  location.href=page+"?event="+id;
}

async function loadEvents(preferredId){
  eventSelect.innerHTML = "<option value=''>Carregando eventos...</option>";

  const { data, error } = await supabase
    .from("events")
    .select("id,title,event_at,created_at")
    .order("created_at", { ascending: false });

  if(error){
    eventSelect.innerHTML = "<option value=''>Erro ao carregar eventos</option>";
    setStatus("Erro ao carregar eventos");
    return;
  }

  if(!data || data.length === 0){
    eventSelect.innerHTML = "<option value=''>Nenhum evento encontrado</option>";
    setStatus("Nenhum evento encontrado");
    return;
  }

  eventSelect.innerHTML = "<option value=''>Selecione um evento</option>";
  for (const event of data){
    const option = document.createElement("option");
    option.value = event.id;
    const dateLabel = event.event_at ? ` — ${formatDateTime(event.event_at)}` : "";
    option.textContent = `${event.title}${dateLabel}`;
    eventSelect.appendChild(option);
  }

  if(preferredId && data.some((event)=> event.id === preferredId)){
    eventSelect.value = preferredId;
    saveEvent();
    return;
  }

  setStatus("Selecione um evento");
}

window.saveEvent = saveEvent;
window.copyInscricao = copyInscricao;
window.openInscricaoQr = openInscricaoQr;
window.closeInscricaoQr = closeInscricaoQr;
window.handleModalClick = handleModalClick;
window.go = go;

(async function(){
  const params=new URLSearchParams(location.search);
  const q=params.get("event");
  if(q){
    localStorage.setItem(STORAGE_KEY,q);
  }

  const saved=localStorage.getItem(STORAGE_KEY);
  setEventChip(saved);
  await loadEvents(saved || q);
})();
</script>

</body>
</html>
